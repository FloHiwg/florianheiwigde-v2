<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
{{ $gtmContainerID := .Site.Params.gtmContainerID | default "" }}
{{ $ga4MeasurementID := .Site.Params.ga4MeasurementID | default "" }}
{{ $hasAnalytics := or $ga4MeasurementID $gtmContainerID }}
<title>{{ if .IsHome }}{{ .Site.Title }} - Product & Code{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}</title>
<meta name="description" content="Berlin-based product professional, software developer, and entrepreneur. Bridging the gap between technical development and business strategy.">
<meta name="author" content="Florian G. Heiwig">

<meta property="og:title" content="{{ if .IsHome }}{{ .Site.Title }} - Product & Code{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}">
<meta property="og:description" content="Berlin-based product professional, software developer, and entrepreneur.">
<meta property="og:type" content="website">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ if .IsHome }}{{ .Site.Title }} - Product & Code{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}">
<meta name="twitter:description" content="Berlin-based product professional, software developer, and entrepreneur.">

<link rel="icon" href="{{ "favicon.ico" | relURL }}">
<link rel="stylesheet" href="{{ "css/styles.css" | relURL }}">

{{ if $hasAnalytics }}
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }

  gtag('consent', 'default', {
    analytics_storage: 'denied',
    ad_storage: 'denied',
    ad_user_data: 'denied',
    ad_personalization: 'denied',
    functionality_storage: 'granted',
    security_storage: 'granted',
    wait_for_update: 500
  });

  try {
    var savedConsent = localStorage.getItem('cookie-consent-choice');
    if (savedConsent === 'accepted') {
      gtag('consent', 'update', {
        analytics_storage: 'granted',
        ad_storage: 'denied',
        ad_user_data: 'denied',
        ad_personalization: 'denied'
      });
    }
  } catch (e) {
    // Ignore storage access issues and keep default denied consent.
  }
</script>
{{ if $ga4MeasurementID }}
<script>
  window.__ga4MeasurementID = '{{ $ga4MeasurementID }}';
  window.__analyticsLoader = window.__analyticsLoader || {};
  window.__analyticsLoader.loaded = window.__analyticsLoader.loaded || false;
  window.__analyticsLoader.load = function () {
    if (window.__analyticsLoader.loaded) {
      return;
    }
    window.__analyticsLoader.loaded = true;

    var script = document.createElement('script');
    script.async = true;
    script.src = 'https://www.googletagmanager.com/gtag/js?id={{ $ga4MeasurementID }}';
    document.head.appendChild(script);

    // Standard Google tag initialization (executed lazily after consent).
    gtag('js', new Date());
    gtag('config', '{{ $ga4MeasurementID }}');
  };

  try {
    if (localStorage.getItem('cookie-consent-choice') === 'accepted') {
      window.__analyticsLoader.load();
    }
  } catch (e) {
    // Ignore storage access issues.
  }
</script>
{{ else }}
<script>
  window.__analyticsLoader = window.__analyticsLoader || {};
  window.__analyticsLoader.loaded = window.__analyticsLoader.loaded || false;
  window.__analyticsLoader.load = function () {
    if (window.__analyticsLoader.loaded) {
      return;
    }
    window.__analyticsLoader.loaded = true;

    var w = window;
    var d = document;
    var s = 'script';
    var l = 'dataLayer';
    var i = '{{ $gtmContainerID }}';
    w[l] = w[l] || [];
    w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
    var f = d.getElementsByTagName(s)[0];
    var j = d.createElement(s);
    var dl = l !== 'dataLayer' ? '&l=' + l : '';
    j.async = true;
    j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
    f.parentNode.insertBefore(j, f);
  };

  try {
    if (localStorage.getItem('cookie-consent-choice') === 'accepted') {
      window.__analyticsLoader.load();
    }
  } catch (e) {
    // Ignore storage access issues.
  }
</script>
{{ end }}
{{ end }}
